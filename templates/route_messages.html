{% extends 'base.html' %}

{% block title %}Yo'nalish bo'yicha xabarlar · TG Yuk statistika{% endblock %}

{% block content %}
<h2 class="text-xl md:text-2xl font-semibold mb-3">Yo'nalish bo'yicha xabarlar</h2>
<p class="subtitle text-sm md:text-base text-slate-600 mb-4">
  Kanal ID: <span class="pill inline-flex items-center rounded-full border border-slate-300 px-2 py-0.5 text-[11px] uppercase tracking-wide text-slate-500">{{ channel_id }}</span>
  {% if origin %} · A nuqta: <strong>{{ origin }}</strong>{% endif %}
  {% if destination %} · B nuqta: <strong>{{ destination }}</strong>{% endif %}
</p>

{% now "Y-m-d" as today %}
<form method="get" class="mt-2" style="display:flex; gap:12px; flex-wrap:wrap; align-items:flex-end;">
  <input type="hidden" name="origin" value="{{ origin }}">
  <input type="hidden" name="destination" value="{{ destination }}">
  <div>
    <label>Boshlanish sanasi</label>
    <input type="date" name="date_from" value="{{ date_from }}"
           class="rounded-md border border-slate-300 bg-white px-4 py-2.5 text-sm md:text-base text-slate-800 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 min-w-[220px] md:min-w-[260px]">
  </div>
  <div>
    <label>Tugash sanasi</label>
    <input type="date" name="date_to" value="{{ date_to }}"
           class="rounded-md border border-slate-300 bg-white px-4 py-2.5 text-sm md:text-base text-slate-800 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 min-w-[220px] md:min-w-[260px]">
  </div>
  <div>
    <button type="submit" class="inline-flex items-center rounded-md bg-blue-600 px-4 py-2 text-sm md:text-base font-semibold text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1">Filtrlash</button>
  </div>
  <div>
    <a class="inline-flex items-center rounded-md bg-slate-100 px-4 py-2 text-sm md:text-base font-medium text-slate-800 hover:bg-slate-200" href="?origin={{ origin }}&destination={{ destination }}&date_from={{ today }}&date_to={{ today }}">Bugungi yuklar</a>
  </div>
</form>

<table class="mt-3 w-full text-sm md:text-base">
  <thead>
  <tr>
    <th>Message ID</th>
    <th>Sana</th>
    <th>Yo'nalish</th>
    <th>Telefon</th>
    <th>To'liq matn</th>
  </tr>
  </thead>
  <tbody>
  {% for sh in shipments %}
  <tr>
    <td>{{ sh.message.message_id }}</td>
    <td>{{ sh.message.date }}</td>
    <td>{{ sh.origin|default:'-' }} → {{ sh.destination|default:'-' }}</td>
    <td>{{ sh.phone|default:'-' }}</td>
    <td style="max-width:480px; white-space:pre-wrap;">{{ sh.message.text }}</td>
  </tr>
  {% empty %}
  <tr>
    <td colspan="5">Bu filtlar bo'yicha yuklar topilmadi.</td>
  </tr>
  {% endfor %}
  </tbody>
</table>

<div class="mt-4">
  <a class="inline-flex items-center rounded-md bg-slate-100 px-4 py-2 text-sm md:text-base font-medium text-slate-800 hover:bg-slate-200" href="{% url 'channel_stats' channel_id %}?date_from={{ date_from }}&date_to={{ date_to }}">⬅ Statistkaga qaytish</a>
</div>
{% endblock %}
